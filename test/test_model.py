import pandas as pd
import pytest
from src.model import make_recommendation, make_clusters

features = pd.DataFrame({'pc1': {0: 0.053794377000000004,
                                 1: -0.07696751,
                                 2: -0.050173804,
                                 3: -0.07813883,
                                 4: 0.13329196},
                         'pc2': {0: 0.086492844,
                                 1: -0.15095618,
                                 2: 0.01284866,
                                 3: 0.01880586,
                                 4: -0.14245594},
                         'pc3': {0: 0.18619968,
                                 1: 0.0027242552,
                                 2: -0.023785956,
                                 3: -0.06724042,
                                 4: 0.029329997000000003},
                         'pc4': {0: 0.035170425,
                                 1: 0.06737149,
                                 2: -0.12492556,
                                 3: -0.02305829,
                                 4: -0.08679212},
                         'pc5': {0: -0.064237796,
                                 1: -0.027696615,
                                 2: 0.17045572,
                                 3: 0.0039412025,
                                 4: 0.072125174},
                         'pc6': {0: 0.012810776000000001,
                                 1: 0.05928079,
                                 2: 0.005080234,
                                 3: -0.030351807999999997,
                                 4: 0.04960230400000001},
                         'pc7': {0: 0.42879656,
                                 1: -0.013782468,
                                 2: 0.02436029,
                                 3: 0.011633961000000002,
                                 4: -0.035521958},
                         'pc8': {0: -0.07821771,
                                 1: 0.018348882,
                                 2: -0.07224039,
                                 3: 0.025430937999999997,
                                 4: 0.19450764},
                         'pc9': {0: 0.015086957,
                                 1: -0.06093551,
                                 2: -0.029813127999999998,
                                 3: -0.01410486,
                                 4: -0.10444858},
                         'pc10': {0: 0.072945885,
                                  1: 0.039285112000000004,
                                  2: 0.1341403,
                                  3: -0.0051520457,
                                  4: 0.010408721999999999},
                         'pc11': {0: 0.13803156,
                                  1: 0.012471709,
                                  2: 0.32819998,
                                  3: -0.0046481104,
                                  4: 0.13271903},
                         'pc12': {0: -0.03692953,
                                  1: 0.0044417987,
                                  2: 0.17356783,
                                  3: 0.030332146,
                                  4: 0.089795396},
                         'pc13': {0: -0.11825177,
                                  1: -0.05877516,
                                  2: 0.09890059,
                                  3: -0.009254272,
                                  4: 0.045987852},
                         'pc14': {0: 0.13501823,
                                  1: 0.007934756,
                                  2: -0.12981309,
                                  3: -0.0148698855,
                                  4: -0.080524854},
                         'pc15': {0: 0.03570454,
                                  1: 0.004375993,
                                  2: -0.03145877,
                                  3: -0.01122109,
                                  4: -0.06281813},
                         'pc16': {0: 0.12394501,
                                  1: 0.052120607,
                                  2: -0.07322258,
                                  3: -0.01330721,
                                  4: 0.23690163},
                         'pc17': {0: -0.27329874,
                                  1: -0.020797817,
                                  2: 0.09203143400000001,
                                  3: -0.023507735,
                                  4: -0.12652735},
                         'pc18': {0: 0.19715726,
                                  1: 0.014547563999999999,
                                  2: 0.009552745999999999,
                                  3: 0.019574523,
                                  4: 0.07896474},
                         'pc19': {0: 0.008176583000000001,
                                  1: 0.06423451,
                                  2: -0.08353941,
                                  3: 0.00235858,
                                  4: 0.023565348},
                         'pc20': {0: -0.14586267,
                                  1: 0.020427038999999998,
                                  2: 0.021473419,
                                  3: -0.09164628400000001,
                                  4: 0.076095656},
                         'pc21': {0: 0.16729736,
                                  1: -0.021044936,
                                  2: -0.04650082,
                                  3: 0.0015737507,
                                  4: -0.20803216},
                         'pc22': {0: -0.04217521,
                                  1: 0.03006891,
                                  2: 0.0434282,
                                  3: 0.06949113,
                                  4: -0.023895176},
                         'pc23': {0: -0.12980771,
                                  1: 0.008628423,
                                  2: 0.0066002230000000005,
                                  3: -0.007952385,
                                  4: -0.07333268},
                         'pc24': {0: -0.11906955,
                                  1: -0.017185904,
                                  2: 0.15157185,
                                  3: -0.010497126,
                                  4: -0.022130152},
                         'pc25': {0: -0.09984232,
                                  1: -0.00075772655,
                                  2: -0.04124409,
                                  3: -0.052446604,
                                  4: 0.023926642},
                         'pc26': {0: -0.11302166400000001,
                                  1: -0.00924938,
                                  2: -0.12398044,
                                  3: 0.020248841,
                                  4: 0.1743569},
                         'pc27': {0: 0.02313127,
                                  1: 0.03466302,
                                  2: 0.05300862,
                                  3: 0.026830869,
                                  4: 0.15880515},
                         'pc28': {0: 0.057173442000000005,
                                  1: -0.0031588427,
                                  2: 0.06971824,
                                  3: -0.030829682999999997,
                                  4: -0.10052668},
                         'pc29': {0: -0.15954345,
                                  1: 0.016421895,
                                  2: 0.07648498,
                                  3: 0.018910026,
                                  4: -0.19977847},
                         'pc30': {0: 0.1686099,
                                  1: 0.006561934,
                                  2: 0.08310258,
                                  3: 0.048370715,
                                  4: 0.010287776}})

vector = pd.Series({'pc1': 0.053794377000000004,
                    'pc2': 0.086492844,
                    'pc3': 0.18619968,
                    'pc4': 0.035170425,
                    'pc5': -0.064237796,
                    'pc6': 0.012810776000000001,
                    'pc7': 0.42879656,
                    'pc8': -0.07821771,
                    'pc9': 0.015086957,
                    'pc10': 0.072945885,
                    'pc11': 0.13803156,
                    'pc12': -0.03692953,
                    'pc13': -0.11825177,
                    'pc14': 0.13501823,
                    'pc15': 0.03570454,
                    'pc16': 0.12394501,
                    'pc17': -0.27329874,
                    'pc18': 0.19715726,
                    'pc19': 0.008176583000000001,
                    'pc20': -0.14586267,
                    'pc21': 0.16729736,
                    'pc22': -0.04217521,
                    'pc23': -0.12980771,
                    'pc24': -0.11906955,
                    'pc25': -0.09984232,
                    'pc26': -0.11302166400000001,
                    'pc27': 0.02313127,
                    'pc28': 0.057173442000000005,
                    'pc29': -0.15954345,
                    'pc30': 0.1686099})

clusters = {'contrast': {0: 0.011183067167761969,
                         1: 0.01189482306129256,
                         2: 0.010328625508276238,
                         3: 0.011633767078712021,
                         4: 0.012428336656498664},
            'B_shadow': {0: 0.003507226346225514,
                         1: 0.02012059173653065,
                         2: 0.010337223692033869,
                         3: 0.01830669058647521,
                         4: 0.008271960875536602},
            'B_dark': {0: 0.011074742912871695,
                       1: 0.009952631015102844,
                       2: 0.017152170293457756,
                       3: 0.014329792072977746,
                       4: 0.01428983519377235},
            'B_light': {0: 0.01942173258084376,
                        1: 0.00544319781095457,
                        2: 0.007741392451473749,
                        3: 0.006814217797585471,
                        4: 0.011425494612134449},
            'B_highlight': {0: 0.015857875023996548,
                            1: 0.004047041493285901,
                            2: 0.0028738391769749963,
                            3: 0.0051059655077911005,
                            4: 0.012863018948251486},
            'G_shadow': {0: 0.004291356733091844,
                         1: 0.020678832984164303,
                         2: 0.010171530926658763,
                         3: 0.01900202068072411,
                         4: 0.00864029419380174},
            'G_dark': {0: 0.009221284461100862,
                       1: 0.01021508613220613,
                       2: 0.01688765730271282,
                       3: 0.013678310924859109,
                       4: 0.014006332525151741},
            'G_light': {0: 0.01849526697204248,
                        1: 0.004746456630378914,
                        2: 0.007513186619082306,
                        3: 0.006592499145422117,
                        4: 0.012332672372496778},
            'G_highlight': {0: 0.01752979275624941,
                            1: 0.003822582918764343,
                            2: 0.00308530222943918,
                            3: 0.004687392501226083,
                            4: 0.01112641829460732},
            'R_shadow': {0: 0.005398067345247878,
                         1: 0.021349840673498325,
                         2: 0.007016641459796543,
                         3: 0.01860286356952701,
                         4: 0.009435702918526205},
            'R_dark': {0: 0.007001932224448673,
                       1: 0.010896613726233559,
                       2: 0.017620251450337125,
                       3: 0.013474254930904666,
                       4: 0.017180724509560732},
            'R_light': {0: 0.014566198445854741,
                        1: 0.003452052287355543,
                        2: 0.011556891948048235,
                        3: 0.00740172527083497,
                        4: 0.010928815463585208},
            'R_highlight': {0: 0.02249933492783578,
                            1: 0.003314329269257662,
                            2: 0.0032810072069494713,
                            3: 0.004564254677496319,
                            4: 0.008479072570708651},
            'B_average': {0: 0.014914319758122026,
                          1: 0.007247517914495506,
                          2: 0.008734621371946246,
                          3: 0.0074127222903231735,
                          4: 0.012311233452473041},
            'G_average': {0: 0.014968570541957146,
                          1: 0.007019147511777077,
                          2: 0.008826868015774706,
                          3: 0.007166479347466169,
                          4: 0.011751501150215048},
            'R_average': {0: 0.01529574067477945,
                          1: 0.0064990622886462405,
                          2: 0.010118033675078231,
                          3: 0.007269203741198358,
                          4: 0.010690451005038895},
            'sharpness': {0: 0.0064305294963532865,
                          1: 0.009307783173246544,
                          2: 0.005793153279654335,
                          3: 0.015688767205526533,
                          4: 0.01768928433082446},
            'red_average': {0: 0.0006102466836745515,
                            1: 0.02345987259552284,
                            2: 0.011940055326344816,
                            3: 0.022136484767192904,
                            4: 0.007900041657722215},
            'orange_average': {0: 0.021496801336509108,
                               1: 0.006539241662085582,
                               2: 0.016594578731784063,
                               3: 0.012076431553376558,
                               4: 0.011890260288522848},
            'yellow_average': {0: 0.01726748037813989,
                               1: 0.004433992679844893,
                               2: 0.0019731051399841147,
                               3: 0.005527462315406042,
                               4: 0.011685447024688215},
            'green_average': {0: 0.00041790314846269295,
                              1: 0.017558416335164632,
                              2: 0.005201883613447414,
                              3: 0.0008647218768092317,
                              4: 0.0025007011297930423},
            'cyan_average': {0: 0.018620492866600804,
                             1: 0.006536616997938075,
                             2: 0.004476639240976176,
                             3: 0.0023071862791289714,
                             4: 0.01202461954401932},
            'blue_average': {0: 0.02270211884751237,
                             1: 0.011622972555076454,
                             2: 0.005627111324824021,
                             3: 0.013011815762680092,
                             4: 0.013306052318768448},
            'purple_average': {0: 0.006281599755000642,
                               1: 0.005759411408216749,
                               2: 0.0083313258152743,
                               3: 0.008491102696544085,
                               4: 0.014080444500902671},
            'pc1': {0: -0.10940614,
                    1: 0.06858527,
                    2: 0.28811288999999995,
                    3: -0.018780257075,
                    4: -0.04224424425},
            'pc2': {0: -0.02945732,
                    1: 0.03914758,
                    2: 0.06194815079999999,
                    3: 0.025522368250000003,
                    4: -0.07722920400000001},
            'pc3': {0: 0.048535453000000006,
                    1: 0.04041038,
                    2: -0.124918495,
                    3: -0.014266290925,
                    4: -0.0024364269999999997},
            'pc4': {0: -0.11277603,
                    1: 0.016205626499999997,
                    2: 0.30925435,
                    3: 0.16323661250000002,
                    4: 0.06203306125},
            'pc5': {0: 0.03574022776666667,
                    1: -0.07534627275,
                    2: -0.13551951299999998,
                    3: 0.04259189325,
                    4: -0.05346230275},
            'pc6': {0: 0.0044261073333333335,
                    1: -0.078765585,
                    2: -0.18458565,
                    3: 0.075378641875,
                    4: -0.00761110425},
            'pc7': {0: -0.014557925666666669,
                    1: -0.144144559,
                    2: -0.11689892000000003,
                    3: 0.061113699999999986,
                    4: -0.1745117325},
            'pc8': {0: -0.007380046166666667,
                    1: -0.0728273145,
                    2: 0.033894943,
                    3: 0.004611544699999999,
                    4: -0.067962914},
            'pc9': {0: 0.12457799666666665,
                    1: 0.005849632,
                    2: -0.101658795,
                    3: -0.056629919,
                    4: 0.078005225},
            'pc10': {0: -0.008065656666666665,
                     1: -0.064478276,
                     2: 0.1065421575,
                     3: 0.05998760025,
                     4: 0.016287803849999997},
            'pc11': {0: -0.05229018533333333,
                     1: 0.12663452,
                     2: -0.044132029,
                     3: 0.0895907225,
                     4: 0.1055716385},
            'pc12': {0: -0.005509861206666668,
                     1: -0.269558255,
                     2: -0.114026592,
                     3: 0.022366126,
                     4: -0.06430152324999999},
            'pc13': {0: 0.18092562666666667,
                     1: -0.118973965,
                     2: -0.124379305,
                     3: -0.01680894125,
                     4: 0.1579446475},
            'pc14': {0: 0.11518352333333333,
                     1: -0.15318727999999998,
                     2: -0.08856771499999999,
                     3: -0.03920085675,
                     4: 0.05782195525},
            'pc15': {0: 0.099050303,
                     1: -0.101369785,
                     2: -0.16434162,
                     3: 0.006660768249999999,
                     4: -0.06545221025},
            'pc16': {0: -0.114128265,
                     1: 0.043090789,
                     2: -0.021558668500000003,
                     3: -0.050163423049999996,
                     4: 0.006657244649999999},
            'pc17': {0: 0.011222129666666669,
                     1: -0.101985775,
                     2: 0.08789778000000001,
                     3: 0.0150889855,
                     4: -0.072993787625},
            'pc18': {0: 0.09933375666666666,
                     1: 0.06975060250000001,
                     2: -0.09011802,
                     3: -0.045678765499999996,
                     4: 0.042581109750000005},
            'pc19': {0: 0.1809555,
                     1: -0.02588341615,
                     2: -0.0317017755,
                     3: 0.009239413250000002,
                     4: 0.0024043904000000003},
            'pc20': {0: -0.09236587,
                     1: 0.089532435,
                     2: -0.073325163,
                     3: -0.053948405250000005,
                     4: 0.014294391000000002},
            'pc21': {0: 0.07170828900000001,
                     1: -0.0148303625,
                     2: -0.0526093595,
                     3: 0.042335354000000006,
                     4: -0.0354980575},
            'pc22': {0: -0.12244801533333335,
                     1: 0.044889425999999996,
                     2: -0.0854583375,
                     3: 0.008350773999999998,
                     4: 0.1391911825},
            'pc23': {0: -0.00702842,
                     1: -0.001740668,
                     2: -0.13422952,
                     3: -0.05766007825,
                     4: -0.031534890675},
            'pc24': {0: -0.02533416,
                     1: -0.074817363,
                     2: 0.17088028,
                     3: 0.011253203750000005,
                     4: 0.004720352999999997},
            'pc25': {0: -0.010749375333333332,
                     1: 0.103554257,
                     2: 0.07727181550000001,
                     3: 0.045331863249999986,
                     4: -0.08481603199999999},
            'pc26': {0: 0.12094291866666665,
                     1: -0.0394580945,
                     2: -0.08073108600000001,
                     3: 0.015511721824999996,
                     4: 0.03485135275},
            'pc27': {0: -0.09227674866666667,
                     1: -0.15426288800000001,
                     2: -0.24221987500000006,
                     3: 0.038858473,
                     4: 0.03131242525},
            'pc28': {0: 0.16452992333333336,
                     1: -0.006798518000000001,
                     2: 0.083540646,
                     3: -0.03305211775,
                     4: -0.0139043425},
            'pc29': {0: -0.10172634666666668,
                     1: 0.023540737,
                     2: -0.0090962865,
                     3: -0.0389934065,
                     4: -0.062668381},
            'pc30': {0: 0.19719573,
                     1: 0.00429128,
                     2: 0.155208283,
                     3: -0.0160287115,
                     4: -0.05963503609999999},
            'images_names': {0: '20191231-DSC06485.jpg,20190824-DSC06269.jpg,20191231-DSC06489.jpg',
                             1: '20190423-DSC05096.jpg,20190423-DSC05082.jpg',
                             2: '20180628-DSC03338.jpg,20180628-DSC03306.jpg',
                             3: '20190804-DSC06103.jpg,20180831-GOPR0589.jpg,DSC09915-1.jpg,20180831-GOPR0747.jpg',
                             4: 'DSC07876.jpg,IMG_2302.jpg,IMG_2300.jpg,20190422-DSC04799.jpg'}}

vector_cluster = {'contrast': 0.01189482306129256,
                  'B_shadow': 0.02012059173653065,
                  'B_dark': 0.009952631015102844,
                  'B_light': 0.00544319781095457,
                  'B_highlight': 0.004047041493285901,
                  'G_shadow': 0.020678832984164303,
                  'G_dark': 0.01021508613220613,
                  'G_light': 0.004746456630378914,
                  'G_highlight': 0.003822582918764343,
                  'R_shadow': 0.021349840673498325,
                  'R_dark': 0.010896613726233559,
                  'R_light': 0.003452052287355543,
                  'R_highlight': 0.003314329269257662,
                  'B_average': 0.007247517914495506,
                  'G_average': 0.007019147511777077,
                  'R_average': 0.0064990622886462405,
                  'sharpness': 0.009307783173246544,
                  'red_average': 0.02345987259552284,
                  'orange_average': 0.006539241662085582,
                  'yellow_average': 0.004433992679844893,
                  'green_average': 0.017558416335164632,
                  'cyan_average': 0.006536616997938075,
                  'blue_average': 0.011622972555076454,
                  'purple_average': 0.005759411408216749,
                  'pc1': 0.06858527,
                  'pc2': 0.03914758,
                  'pc3': 0.04041038,
                  'pc4': 0.016205626499999997,
                  'pc5': -0.07534627275,
                  'pc6': -0.078765585,
                  'pc7': -0.144144559,
                  'pc8': -0.0728273145,
                  'pc9': 0.005849632,
                  'pc10': -0.064478276,
                  'pc11': 0.12663452,
                  'pc12': -0.269558255,
                  'pc13': -0.118973965,
                  'pc14': -0.15318727999999998,
                  'pc15': -0.101369785,
                  'pc16': 0.043090789,
                  'pc17': -0.101985775,
                  'pc18': 0.06975060250000001,
                  'pc19': -0.02588341615,
                  'pc20': 0.089532435,
                  'pc21': -0.0148303625,
                  'pc22': 0.044889425999999996,
                  'pc23': -0.001740668,
                  'pc24': -0.074817363,
                  'pc25': 0.103554257,
                  'pc26': -0.0394580945,
                  'pc27': -0.15426288800000001,
                  'pc28': -0.006798518000000001,
                  'pc29': 0.023540737,
                  'pc30': 0.00429128}


def test_make_recommendation():
    """Test happy path for make_recommendation()."""

    input_features = pd.DataFrame(features)
    input_vector = pd.Series(vector)

    true_output = [0, 3, 4, 1, 2]
    result = make_recommendation(input_features, input_vector, 5)

    assert true_output == result


def test_make_recommendation_unhappy():
    """Test unhappy path for make_recommendation()."""

    input_features = 'Bad'
    input_vector = pd.Series(vector)
    with pytest.raises(TypeError):
        make_recommendation(input_features, input_vector, 5)


def test_make_clusters():
    """Test happy path for make_clusters()."""

    input_clusters = pd.DataFrame(clusters).set_index('images_names')
    input_vector = pd.Series(vector_cluster)

    true_output = [['20190423-DSC05096.jpg', '20190423-DSC05082.jpg'],
                   ['20180628-DSC03338.jpg', '20180628-DSC03306.jpg'],
                   ['DSC07876.jpg', 'IMG_2302.jpg', 'IMG_2300.jpg', '20190422-DSC04799.jpg'],
                   ['20190804-DSC06103.jpg',
                    '20180831-GOPR0589.jpg',
                    'DSC09915-1.jpg',
                    '20180831-GOPR0747.jpg'],
                   ['20191231-DSC06485.jpg', '20190824-DSC06269.jpg', '20191231-DSC06489.jpg']]
    result = make_clusters(input_clusters, input_vector, 5)

    assert true_output == result


def test_make_clusters_unhappy():
    """Test unhappy path for make_clusters()."""

    input_features = 'Bad'
    input_vector = pd.Series(vector_cluster)
    with pytest.raises(TypeError):
        make_clusters(input_features, input_vector, 5)
